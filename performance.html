<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Performance Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
  body {
    font-family: 'Inter', sans-serif;
    background: #f7f9fc;
    margin: 0;
    padding: 0;
    color: #333;
  }
  .container {
    max-width: 1000px;
    margin: 40px auto;
    background: white;
    padding: 30px;
    border-radius: 16px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.05);
  }
  h1 {
    text-align: center;
    color: #1a237e;
  }
  .date-picker {
    display: flex;
    justify-content: center;
    margin: 20px 0;
  }
  input[type="date"] {
    padding: 10px 15px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 16px;
  }
  .data-section {
    margin-top: 25px;
  }
  .field {
    margin-bottom: 12px;
  }
  .field strong {
    color: #1a237e;
  }
  .system-issue-card {
    background: #fff8f0;
    border-left: 5px solid #f5a623;
    padding: 20px;
    margin-top: 25px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.05);
  }
  .system-issue-card h3 {
    margin-bottom: 10px;
    color: #c37d0e;
  }
  .system-issue-card p {
    margin: 5px 0;
    color: #444;
  }
  #noData {
    text-align: center;
    color: #999;
    margin-top: 40px;
  }
</style>
</head>

<body>
<div class="container">
  <h1>üìä Performance Dashboard</h1>

  <div class="date-picker">
    <input type="date" id="datePicker" />
  </div>

  <div id="dataSection" class="data-section"></div>
  <div id="noData"></div>
</div>

<script>
  let csvData = [];

  // Load CSV using PapaParse
  Papa.parse("performance_us_cms.csv", {
    download: true,
    header: true,
    complete: function(results) {
      csvData = results.data;
      console.log("CSV Loaded:", csvData.length, "records");
    }
  });

  // Helper function to detect system issue
  function hasSystemIssue(row) {
    const fields = [
      "System Issue",
      "System issue Ticket number",
      "Issue Description",
      "Issue Start Time",
      "Issue End Time",
      "Tools Impacted",
      "LOB Impacted"
    ];
    return fields.some(f => row[f] && row[f].trim() !== "");
  }

  // Function to format date properly
  function normalizeDate(dateStr) {
    if (!dateStr) return "";
    const parts = dateStr.split(/[\/\-]/);
    if (parts.length === 3) {
      // Try MM/DD/YYYY or DD/MM/YYYY formats
      const [p1, p2, p3] = parts.map(x => x.trim());
      if (parseInt(p1) > 12) {
        // DD/MM/YYYY
        return `${p3}-${p2.padStart(2, '0')}-${p1.padStart(2, '0')}`;
      } else {
        // MM/DD/YYYY
        return `${p3}-${p1.padStart(2, '0')}-${p2.padStart(2, '0')}`;
      }
    }
    return dateStr;
  }

  // Event Listener for Date Change
  document.getElementById("datePicker").addEventListener("change", function() {
    const selectedDate = this.value;
    const row = csvData.find(r => normalizeDate(r.Date) === selectedDate);

    const dataSection = document.getElementById("dataSection");
    const noDataDiv = document.getElementById("noData");
    dataSection.innerHTML = "";
    noDataDiv.textContent = "";

    if (!row) {
      noDataDiv.textContent = "No data available for this date.";
      return;
    }

    // Create main data display
    for (const key in row) {
      if (key.startsWith("System")) continue; // Skip system columns in main view
      if (row[key] && row[key].trim() !== "") {
        const div = document.createElement("div");
        div.className = "field";
        div.innerHTML = `<strong>${key}:</strong> ${row[key]}`;
        dataSection.appendChild(div);
      }
    }

    // Handle system issue section
    if (hasSystemIssue(row)) {
      const sys = document.createElement("div");
      sys.className = "system-issue-card";
      sys.innerHTML = `
        <h3>‚ö†Ô∏è System Issue: Yes</h3>
        <p><strong>Ticket:</strong> ${row["System issue Ticket number"] || "N/A"}</p>
        <p><strong>Description:</strong> ${row["Issue Description"] || "N/A"}</p>
        <p><strong>Start:</strong> ${row["Issue Start Time"] || "-"} | 
           <strong>End:</strong> ${row["Issue End Time"] || "-"}</p>
        <p><strong>Tools Impacted:</strong> ${row["Tools Impacted"] || "N/A"}</p>
        <p><strong>LOB Impacted:</strong> ${row["LOB Impacted"] || "N/A"}</p>
      `;
      dataSection.appendChild(sys);
    }
  });
</script>
</body>
</html>
